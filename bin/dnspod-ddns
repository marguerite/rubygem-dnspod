#!/usr/bin/env ruby

$LOAD_PATH.push(File.expand_path(File.dirname(__FILE__) + '/../lib'))

require 'dnspod'

# We just use the first domain

domain_id = DNSPod::DomainList.get_domain_id(0)

current_ip = open('http://ident.me').read

DNSPod::RecordDDNS.new(domain_id).set(current_ip)

open('/var/log/dnspod.log', 'a+:UTF-8') do |f|
  f.write "Successfully set A record to #{current_ip} at #{Time.now}"
end
